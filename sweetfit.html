<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sweetfit - 디저트 추천</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
    .section { margin-bottom: 40px; }
    .graph-container { width: 600px; height: 400px; margin: auto; }
    button { padding: 10px 20px; font-size: 16px; margin: 10px; cursor: pointer; }
    #recommendationPage, #diaryPage, #newsPage { display: none; }
    .result-image { max-width: 300px; margin-top: 20px; }
    .news-item { margin-bottom: 30px; text-align: left; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
    .news-item img { max-width: 100%; height: auto; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>Sweetfit - 당신만을 위한 디저트</h1>
  <button onclick="showPage('recommendationPage')">맞춤형 디저트 추천받기</button>
  <button onclick="showPage('diaryPage')">나만의 디저트 일기</button>
  <button onclick="showPage('newsPage')">오늘의 디저트 뉴스</button>

  <!-- 추천 페이지 -->
  <div id="recommendationPage">
    <h2>오늘은 어떤 디저트가 땡기시나요?</h2>
    <div class="section">
      <h3>디저트 선택</h3>
      <label><input type="radio" name="dessert" value="케이크"> 케이크</label>
      <label><input type="radio" name="dessert" value="도넛"> 도넛</label>
      <label><input type="radio" name="dessert" value="쿠키"> 쿠키</label>
    </div>

    <div class="section">
      <h3>옵션 선택 (하나만 선택)</h3>
      <label><input type="radio" name="option" value="비건"> 비건</label>
      <label><input type="radio" name="option" value="저당"> 저당</label>
      <label><input type="radio" name="option" value="글루텐프리"> 글루텐프리</label>
    </div>

    <div class="section">
      <h3>칼로리 / 당 수치</h3>
      <select id="calorieRange">
        <option value="1-200">1~200</option>
        <option value="201-400">201~400</option>
      </select>
      <select id="sugarRange">
        <option value="0-10">0~10g</option>
        <option value="11-20">11~20g</option>
      </select>
      <br><br>
      <button onclick="searchDesserts()">검색</button>
      <div id="result"></div>
    </div>
  </div>

  <!-- 일기 페이지 -->
  <div id="diaryPage">
    <h2>나만의 디저트 일기</h2>
    <p>자유롭게 기록해보세요!</p>
    <textarea id="diary" rows="5" cols="60" placeholder="예: 딸기 케이크가 퐁신하고 부드러웠다."></textarea><br><br>
    <input type="file" id="imageUpload" accept="image/*">
    <input type="number" id="calorieInput" placeholder="당 수치 입력 (g)"><br><br>
    <button onclick="saveDiary()">기록 저장</button>

    <div class="section graph-container">
      <h3>내 몸은 내가 지킨당</h3>
      <canvas id="calorieChart"></canvas>
    </div>
  </div>

  <!-- 뉴스 페이지 -->
  <div id="newsPage">
    <h2>디저트 뉴스</h2>
    <div id="newsContainer"></div>
  </div>

  <script>
    // 초기 페이지 설정
    document.addEventListener('DOMContentLoaded', () => {
      showPage('recommendationPage');
    });

    function showPage(pageId) {
      const pages = ['recommendationPage', 'diaryPage', 'newsPage'];
      pages.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
      const target = document.getElementById(pageId);
      if (target) target.style.display = 'block';
    }

    function saveDiary() {
      const sugar = parseFloat(document.getElementById('calorieInput').value);
      if (!isNaN(sugar)) {
        const clamped = Math.min(Math.max(sugar, 0), 25);
        if (!window.chart) {
          const ctx = document.getElementById('calorieChart').getContext('2d');
          window.chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: ['섭취한 당', '남은 당'],
              datasets: [{
                data: [clamped, 25 - clamped],
                backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(200, 200, 200, 0.3)'],
                borderColor: 'rgba(255, 255, 255, 1)',
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { position: 'bottom' },
                title: {
                  display: true,
                  text: '하루 권장 당 섭취량 (기준: 25g)'
                }
              }
            }
          });
        } else {
          window.chart.data.datasets[0].data = [clamped, 25 - clamped];
          window.chart.update();
        }
      }
      alert('기록이 저장되었습니다!');
    }

    function searchDesserts() {
      const dessertType = document.querySelector('input[name="dessert"]:checked');
      const option = document.querySelector('input[name="option"]:checked');
      const calorieRange = document.getElementById('calorieRange').value.split('-');
      const sugarRange = document.getElementById('sugarRange').value.split('-');

      if (!dessertType || !option) {
        alert("디저트와 옵션을 모두 선택해주세요.");
        return;
      }

      const results = dessertDB.filter(d => 
        d.type === dessertType.value &&
        d.options.includes(option.value) &&
        d.calorie >= Number(calorieRange[0]) &&
        d.calorie <= Number(calorieRange[1]) &&
        d.sugar >= Number(sugarRange[0]) &&
        d.sugar <= Number(sugarRange[1])
      );

      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '';

      if (results.length === 0) {
        resultDiv.innerHTML = `<p>조건에 맞는 디저트가 없습니다.</p>`;
      } else {
        results.forEach(dessert => {
          resultDiv.innerHTML += `
            <div>
              <h4>${dessert.name}</h4>
              <p>칼로리: ${dessert.calorie}kcal / 당: ${dessert.sugar}g</p>
              <p>위치: ${dessert.location}</p>
              <img class="result-image" src="${dessert.image}" alt="${dessert.name}">
            </div><hr>`;
        });
      }
    }

    const dessertDB = [
      // 예시 데이터 일부
      {
        name: '저당 요거트 도넛',
        type: '도넛',
        options: ['저당'],
        calorie: 230,
        sugar: 5,
        location: '노티드',
        image: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FIMG_2686.JPG&type=a340'
      },
      {
        name: '비건 초코 케이크',
        type: '케이크',
        options: ['비건'],
        calorie: 180,
        sugar: 8,
        location: '플랜트',
        image: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FIMG_1468.JPG&type=a340'
      }
    ];
  </script>
</body>
</html>
